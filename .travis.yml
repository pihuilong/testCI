sudo: enabled
services:
- docker
language: node_js
node_js:
- '12'
before_install:
- curl -Lo kubectl https://storage.googleapis.com/kubernetes-release/release/v1.7.0/bin/linux/amd64/kubectl
  && chmod +x kubectl && sudo mv kubectl /usr/local/bin/
- curl -Lo skaffold https://storage.googleapis.com/skaffold/releases/latest/skaffold-linux-amd64
  && chmod +x skaffold && sudo mv skaffold /usr/local/bin/
install:
- yarn --cwd ./app install
script:
- yarn --cwd ./app test
after_success:
- echo "$DOCKER_PASSWORD" | docker login -u "$DOCKER_USERNAME" --password-stdin
- echo "$DOCKER_USERNAME"
- mkdir ${HOME}/.kube
- cp ./k8s/config.yaml ${HOME}/.kube/config
- cat ${HOME}/.kube/config
- cd ${HOME}/.kube
- sed -i 's/KUBE_CLUSTER_NAME/'"$KUBE_CLUSTER_NAME"'/g' config
- sed -i 's/KUBE_CLUSTER_CERTIFICATE/'"$KUBE_CLUSTER_CERTIFICATE"'/g' config
- sed -i 's/KUBE_CLIENT_CERTIFICATE/'"$KUBE_CLIENT_CERTIFICATE"'/g' config
- sed -i 's/KUBE_CLIENT_KEY/'"$KUBE_CLIENT_KEY"'/g' config
- sed -i 's/KUBE_ADMIN_PWD/'"$KUBE_ADMIN_PWD"'/g' config
- kubectl version
- kubectl config use-context $KUBE_CLUSTER_NAME
- cd $TRAVIS_BUILD_DIR
- skaffold run
env:
  global:
    secure: 3HTlxoFWpz1OeJYH3+O/tnu+Uz+vrim+6bZdFM8w/FqaHQRFkCoV24cNGh0YXzSnrnOYplrCdXyt21bVcOHvn3YzZBauaANDzd5diK/ZbrZ0bckZnMu+NtEwAqrSdDQ9XUQ5kKjVcwAB/TdNFowejBcNwElQpJIHB6o8Qp9dF87t7cUVHmWniqE8+8tJQsn/+FA2DuZEbbOqBzWJIZUUc4DerU9DRUXG+H70Op3yt+HLy8Z1GDr8ey2l3zcf/73fH6DVjLjZ7N1Y4vCZu0b0Jp4+Xm6X6tk/wy1VCxf+J1LNEbzBH4Im+vL34TNSoDCIXFqseXP7SUkyfDDdwgG+STGUBaHfRJ3rdgXEEm0Psr7GZsNsIo24WFLDWqqnPyfYwI71FB7OG+wBtfK5Jnev7t8FdLx6WE2b7kg/D93L7iIvl+a27gLixGwaS6+YqJm3Cm74YAgnz7AyheY+KnebArPXPABrasrQwmJ/yPO+WBrK4kCBdpwLAoAS/4FlmMBDXDimRXDpBTjnLKYmHDBkzlsq+fn8QWYkSAC6tnC4aYeJxMkfsgC2TLrGyavgxgVVOFEuEY6zlR9iCaiqUbjjLitwyU73w/q6KY6AP0kH0qBvTqFRGN0cTE9RbRO1281+XwOWz6C4GduUnXNAAoDVPCI0h6cjflQlO2tUhYYCoE8=
